---
import { getLangFromUrl, useTranslations } from '#i18n/utils'
import BaseLayout from '#layouts/BaseLayout.astro'
import { DEFAULT_CONFIGURATION } from '#lib/constants'
import { Image } from 'astro:assets'
import { getCollection, render } from 'astro:content'
import { getRelativeLocaleUrl } from 'astro:i18n'

export async function getStaticPaths() {
  const entries = await getCollection('posts')

  return entries.map((entry) => {
    const [slug, lang] = entry.slug.split('/')
    return {
      params: { slug, lang },
      props: { entry },
    }
  })
}

const lang = getLangFromUrl(Astro.url)
const t = useTranslations(lang)
const { entry } = Astro.props
const { Content } = await render(entry)
---

<BaseLayout seo={entry.data.seo}>
  <div>
    <a class="btn btn-primary" href={getRelativeLocaleUrl(lang, '/posts')}
      ><svg
        xmlns="http://www.w3.org/2000/svg"
        width="32"
        height="32"
        viewBox="0 0 24 24"
      >
        <path
          fill="none"
          stroke="currentColor"
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="m12 19l-7-7l7-7m7 7H5"></path></svg
      >{t('posts.back')}
    </a>
  </div>
  <section class="pt-4">
    <article>
      <h1>{entry.data.title}</h1>

      {
        entry.data.image && (
          <div>
            <Image src={entry.data.image} alt={entry.data.title} />
          </div>
        )
      }
      <div>
        <Content />
      </div>
    </article>
  </section>
</BaseLayout>
