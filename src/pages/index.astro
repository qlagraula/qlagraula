---
import { getEntry, getCollection, render } from 'astro:content'
import BaseLayout from '#layouts/BaseLayout.astro'

import Author from '#components/ui/Author.astro'
import { DEFAULT_CONFIGURATION } from '#lib/constants'
import WorkExperience from '#components/ui/WorkExperience.astro'
import { sortJobsByDate } from '#lib/utils'

const entry = await getEntry('pages', 'homepage')

if (!entry) {
  throw new Error('Homepage entry not found')
}

const { Content } = await render(entry)

const links = await getCollection('links')
const jobs = await getCollection('jobs')
const sortedJobs = sortJobsByDate(jobs)
---

<BaseLayout seo={entry.data.seo}>
  <section>
    <Author {...DEFAULT_CONFIGURATION.author} />
  </section>

  <section>
    <h2>About</h2>

    <Content />
  </section>
  {
    links.length > 0 && (
      <section>
        <h2>Contact</h2>
        <ul class="p-0 flex flex-col gap-4">
          {links.map((link) => (
            <li class="flex not-prose max-md:flex-col items-baseline">
              <span class="md:min-w-40 opacity-75 text-sm">
                {link.data.label}
              </span>
              <a
                rel="noopener noreferrer"
                target="_blank"
                class="link link-hover text-base-content font-semibold"
                href={link.data.url}
              >
                {link.data.name}
              </a>
            </li>
          ))}
        </ul>
      </section>
    )
  }
  {
    sortedJobs.length > 0 && (
      <section>
        <h2>Work Experience</h2>
        <ul class="p-0 flex flex-col gap-4">
          {sortedJobs.map((job, index) => (
            <>
              <WorkExperience entry={job} />
              {index + 1 !== sortedJobs.length && <div class="divider m-0" />}
            </>
          ))}
        </ul>
      </section>
    )
  }
</BaseLayout>
