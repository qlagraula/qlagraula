---
import { getEntry, getCollection, render } from 'astro:content'
import BaseLayout from '#layouts/BaseLayout.astro'
import Container from '#components/Container.astro'
import Author from '#components/ui/Author.astro'
import { DEFAULT_CONFIGURATION } from '#lib/constants'
import WorkExperience from '#components/ui/WorkExperience.astro'
import Talk from '#components/ui/Talk.astro'
import { sortJobsByDate } from '#lib/utils'

const entry = await getEntry('pages', 'homepage')

if (!entry) {
  throw new Error('Homepage entry not found')
}

const { Content } = await render(entry)

const links = await getCollection('links')
const jobs = await getCollection('jobs')
const sortedJobs = sortJobsByDate(jobs)
const talks = await getCollection('talks')
---

<BaseLayout seo={entry.data.seo}>
  <Container as="section">
    <Author {...DEFAULT_CONFIGURATION.author} />
  </Container>

  <Container as="section">
    <div>
      <div>
        <span>About</span>
      </div>
      <div>
        <Content />
      </div>
    </div>
  </Container>
  {
    links.length > 0 && (
      <Container as="section">
        <div>
          <span>Contact</span>
          <ul>
            {links.map((link) => (
              <li>
                <div>
                  <span>{link.data.label}</span>
                  <a
                    rel="noopener noreferrer"
                    target="_blank"
                    href={link.data.url}
                  >
                    {link.data.name}
                  </a>
                </div>
              </li>
            ))}
          </ul>
        </div>
      </Container>
    )
  }
  {
    sortedJobs.length > 0 && (
      <Container as="section">
        <div>
          <span>Work Experience</span>
          <ul>
            {sortedJobs.map((job) => (
              <WorkExperience entry={job} />
            ))}
          </ul>
        </div>
      </Container>
    )
  }
  {
    talks.length > 0 && (
      <Container as="section">
        <div>
          <span>Speaking</span>
          <ul>
            {talks.map((talk) => (
              <Talk entry={talk} />
            ))}
          </ul>
        </div>
      </Container>
    )
  }
</BaseLayout>
